<!-- Using the Angular Component Development Kit Table Module, and not Angular Material -->
<table cdk-table [dataSource]="dataSource$" class="govuk-table" [multiTemplateDataRows]="true">

  <!-- Column Headers and Cells -->
  <ng-container *ngFor="let field of fields" [cdkColumnDef]="field.name">
    <th class="govuk-table__header" [attr.aria-sort]="isColumnSorted(field.name)" (click)="onSortHandler(field.name)" cdk-header-cell *cdkHeaderCellDef>
      <button type="button" data-index="0">{{field.columnLabel}}</button>
    </th>
    <td class="govuk-table__cell border-none" cdk-cell *cdkCellDef="let rowData">
      <exui-task-field [task]="rowData" [config]="field"></exui-task-field>
    </td>
  </ng-container>

  <!-- Manage column -->
  <ng-container cdkColumnDef="manage">
    <th class="govuk-table__header" cdk-header-cell *cdkHeaderCellDef>&nbsp;</th>
    <td  class="govuk-table__cell border-none" cdk-cell *cdkCellDef="let rowData" (click)="setSelectedRow(rowData)">
      <div *ngIf="!isRowSelected(rowData); else downArrow">&#9658;&nbsp;Manage</div>
      <ng-template #downArrow>&#9660;&nbsp;Manage</ng-template>
    </td>
  </ng-container>

  <ng-container cdkColumnDef="actions">
    <td cdk-cell *cdkCellDef="let rowData" [attr.colspan]="displayedColumns.length">
      <ng-container *ngIf="isRowSelected(rowData)">
        <div *ngFor="let action of rowData.actions" class="actions">
          <a (click)="onActionHandler(rowData, action)" class="action">{{action.title}}</a>
        </div>
      </ng-container>
    </td>
  </ng-container>

  <!-- Table Header Row -->
  <tr class="govuk-table__row" cdk-header-row *cdkHeaderRowDef="displayedColumns"></tr>

  <!-- Table Row -->
  <tr class="govuk-table__row" cdk-row *cdkRowDef="let row; columns: displayedColumns"></tr>
  <tr cdk-row *cdkRowDef="let row; columns: ['actions']" when="() => false"></tr>

</table>
