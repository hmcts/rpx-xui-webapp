<exui-page-wrapper [backLink]="'../'">
  <div class="govuk-grid-column-full">
    <div *ngIf="errors">
      <exui-error-message [error]="errors"></exui-error-message>
    </div>

    <div>
      <ng-content select="[pageHeader]"></ng-content>
      <form [formGroup]="form" (ngSubmit)="submitForm(form)">
        <div class="govuk-label govuk-label--m govuk-!-margin-bottom-4">
          Personal Information
        </div>

        <div class="govuk-form-group" [class.govuk-form-group--error]="submitted && form.get('first_name')?.invalid">
          <h3 class="govuk-label">
            First name
          </h3>
          <p *ngIf="submitted && form.get('first_name')?.errors?.required" id="first_name-required-error" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error: </span>{{ VALIDATION_ERROR_MESSAGES['first_name.required'] }}
          </p>
          <div class="govuk-body">
            <input type="text" class="govuk-input" [class.govuk-input--error]="submitted && form.get('first_name')?.invalid"
                   formControlName="first_name"
                   id="first_name"
            />
          </div>
        </div>

        <div class="govuk-form-group" [class.govuk-form-group--error]="submitted && form.get('last_name')?.invalid">
          <h3 class="govuk-label">
            Last name
          </h3>
          <p *ngIf="submitted && form.get('last_name')?.errors?.required" id="last_name-required-error" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error: </span>{{ VALIDATION_ERROR_MESSAGES['last_name.required'] }}
          </p>
          <div class="govuk-body">
            <input type="text" class="govuk-input" [class.govuk-input--error]="submitted && form.get('last_name')?.invalid"
                   formControlName="last_name"
                   id="last_name"
            />
          </div>
        </div>

        <div class="govuk-form-group" [class.govuk-form-group--error]="submitted && form.get('email_id')?.invalid">
          <h3 class="govuk-label">
            Email
          </h3>
          <p *ngIf="submitted && form.get('email_id')?.errors?.required" id="email_id-required-error" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error: </span>{{ VALIDATION_ERROR_MESSAGES['email_id.required'] }}
          </p>
          <p *ngIf="submitted && form.get('email_id')?.errors?.email" id="email_id-email-error" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error: </span>{{ VALIDATION_ERROR_MESSAGES['email_id.email'] }}
          </p>
          <div class="govuk-body">
            <input type="text" class="govuk-input" [class.govuk-input--error]="submitted && form.get('email_id')?.invalid"
                   formControlName="email_id"
                   id="email_id"
            />
          </div>
        </div>
        <hr />

        <div class="govuk-form-group" [class.govuk-form-group--error]="submitted && form.get('region_id')?.invalid">
          <h3 class="govuk-label govuk-label--m">
            Region
          </h3>
          <p *ngIf="submitted && form.get('region_id')?.errors?.required" id="region_id-required-error" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error: </span>{{ VALIDATION_ERROR_MESSAGES['region_id.required'] }}
          </p>
          <div class="govuk-body">
            <select class="govuk-select" [class.govuk-select--error]="submitted && form.get('first_name')?.invalid"
                    name="region_id" id="region_id" formControlName="region_id">
              <option *ngFor="let item of staffFilterOptions.regions" [value]="item.region_id">
                {{ item.description }}
              </option>
            </select>
          </div>
        </div>
        <hr />

        <div class="govuk-form-group" [class.govuk-form-group--error]="submitted && form.get('services')?.invalid" id="services">
          <h3 class="govuk-label govuk-label--m">
            Services
          </h3>
          <p *ngIf="submitted && form.get('services')?.errors?.minlength" id="services-required-error" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error: </span>{{ VALIDATION_ERROR_MESSAGES['services.minlength'] }}
          </p>
          <div class="govuk-body">
            <div class="govuk-checkboxes govuk-checkboxes--small" formGroupName="services" attr.field="service" id="checkbox_service">
              <div *ngFor="let item of staffFilterOptions.services; let i = index" class="govuk-checkboxes__item">
                <input type="checkbox" class="govuk-checkboxes__input"
                     [formControlName]="i"
                     (change)="toggleSelectServices($event, form)"
                     [value]="item.key" [id]="'checkbox_service' + item.key"
                     [name]="'checkbox_service' + item.key"
                />
                <label
                [for]="'checkbox_service' + item.key"
                class="govuk-label govuk-checkboxes__label"
                  >{{item.label}}</label>
              </div>
            </div>
          </div>
        </div>
        <hr />

        <div id="base_locations" class="govuk-form-group"
             [class.govuk-form-group--error]="submitted && form.get('base_locations')?.invalid">
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
            <h2 class="govuk-heading-m">
              Locations
            </h2>
            <p *ngIf="submitted && form.get('base_locations')?.errors?.required" id="location-required-error" class="govuk-error-message">
              <span class="govuk-visually-hidden">Error: </span>{{ VALIDATION_ERROR_MESSAGES['base_locations.required'] }}
            </p>
          </legend>

          <div id="base_locations_primary" class="govuk-form-group">
            <h3 class="govuk-heading-s">Primary location</h3>
            <p>A user can only have one primary location.</p>

            <div>
              <exui-staff-select-location
                [formControl]="baseLocationsFormControl"
                [isPrimaryMode]="true"
                [addButtonTitle]="'Add primary location'"
                [serviceCodes$]="staffAddEditFormService.serviceCodes$"
              >
              </exui-staff-select-location>
            </div>
          </div>

          <div id="base_locations_additional" class="govuk-form-group">
            <h3 class="govuk-heading-s">
              Additional locations <span class="govuk-label govuk-checkboxes__label">(optional)</span>
            </h3>

            <div>
              <exui-staff-select-location
                [formControl]="baseLocationsFormControl"
                [addButtonTitle]="'Add additional locations'"
                [serviceCodes$]="staffAddEditFormService.serviceCodes$"
              >
              </exui-staff-select-location>
            </div>
          </div>
        </div>

        <hr />
        <div class="govuk-form-group" [class.govuk-form-group--error]="submitted && form.get('user_type')?.invalid">
          <h3 class="govuk-label govuk-label--m">
            User type
          </h3>
          <p *ngIf="submitted && form.get('user_type')?.errors?.required" id="user_type-required-error" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error: </span>{{ VALIDATION_ERROR_MESSAGES['user_type.required'] }}
          </p>
          <div class="govuk-body">
            <select class="govuk-select" [class.govuk-select--error]="submitted && form.get('user_type')?.invalid"
                    name="user_type" id="user_type" formControlName="user_type">
              <option class="govuk-radios__item" *ngFor="let item of staffFilterOptions.userTypes" [value]="item.label">{{item.label}}</option>
            </select>
          </div>
        </div>
        <hr />

        <div id="userRoles" class="govuk-form-group">
          <h3 class="govuk-label govuk-label--m">
            Role
          </h3>
          <div class="govuk-body">
            <div class="govuk-checkboxes govuk-checkboxes--small">
              <div *ngFor="let item of staffFilterOptions.userRoles; let i = index" class="govuk-checkboxes__item">
                <input type="checkbox" class="govuk-checkboxes__input"
                       [formControlName]="item.key"
                       [id]="'checkbox_userRoles' + item.key"
                       [name]="'checkbox_userRoles' + item.key"
                />
                <label [for]="'checkbox_userRoles' + item.key" class="govuk-label govuk-checkboxes__label">
                  {{item.label}}
                </label>
              </div>
            </div>
          </div>
        </div>
        <hr />

        <div id="roles" class="govuk-form-group" [class.govuk-form-group--error]="submitted && form.get('roles')?.invalid">
          <h3 class="govuk-label govuk-label--m">
            Job title
          </h3>

          <p *ngIf="submitted && form.get('roles')?.errors?.minlength" id="roles-required-error" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error: </span>{{ VALIDATION_ERROR_MESSAGES['roles.minlength'] }}
          </p>
          <div class="govuk-body">
            <div class="govuk-checkboxes govuk-checkboxes--small" formGroupName="roles" id="checkbox_job_title">
              <div *ngFor="let item of staffFilterOptions.jobTitles; let i = index" class="govuk-checkboxes__item">
                <input type="checkbox" class="govuk-checkboxes__input"
                       [formControlName]="i"
                       [value]="item" [id]="'checkbox_job_title' + item.key"
                       [name]="'checkbox_job_title' + item.key"
                />
                <label
                [for]="'checkbox_job_title' + item.key"
                class="govuk-label govuk-checkboxes__label"
                  >{{item.label}}</label>
              </div>
            </div>
          </div>
        </div>

        <div id="skills" class="govuk-form-group">
          <h3 class="govuk-label govuk-label--m">
            Skills
          </h3>
          <div class="govuk-checkboxes govuk-checkboxes--small" formGroupName="skills" attr.field="skills" id="checkbox_skills">
            <div *ngFor="let item of filteredSkillsByServicesCheckbox; let i = index" class="govuk-checkboxes__item">
              <input type="checkbox" class="govuk-checkboxes__input"
                     [formControlName]="i"
                     (change)="toggleSelectSkills($event)"
                     [value]="item.key"
                     [name]="'checkbox_skills_' + i + '_' + item.key"
                     [id]="'checkbox_skills_' + i + '_' + item.key"
              />

              <label class="govuk-label govuk-checkboxes__label"
                [for]="'checkbox_skills_' + i + '_' + item.key"
                [ngClass]="{'govuk-!-font-weight-bold': item.selectAll}">
                {{item.label}}
              </label>
            </div>
          </div>
        </div>
        <hr />
        <div class="govuk-grid-row">
          <div class="govuk-grid-column-full">
            <button
              class="govuk-button govuk-!-margin-right-1 govuk-!-margin-bottom-0"
              type="submit"
              id="submitAddEditStaffUserForm"
            >Continue</button>
            <button
              class="govuk-button govuk-button--secondary govuk-!-margin-bottom-0"
              type="button"
              id="cancelForm"
              [routerLink]="'../'"
            >Cancel</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</exui-page-wrapper>
