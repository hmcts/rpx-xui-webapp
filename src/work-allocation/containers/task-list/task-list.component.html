<!-- Using the Angular Component Development Kit Table Module, and not Angular Material -->
<table cdk-table [dataSource]="dataSource$" class="govuk-table" [multiTemplateDataRows]="true">

  <!-- Column Headers and Cells through the field config from the API-->
  <ng-container *ngFor="let field of fields" [cdkColumnDef]="field.name">
    <th cdk-header-cell *cdkHeaderCellDef>{{field.columnLabel}}<button (click)="onSortHandler(field.name)">sort</button></th>
    <td cdk-cell *cdkCellDef="let rowData">{{rowData[field.name]}}</td>
  </ng-container>

  <!-- Manage column -->
  <ng-container cdkColumnDef="manage">
    <th cdk-header-cell *cdkHeaderCellDef>&nbsp;</th>
    <td cdk-cell *cdkCellDef="let rowData">Manage <button (click)="setSelectedRow(rowData)">&#9658;</button></td>
  </ng-container>

  <ng-container cdkColumnDef="actions">
    <td cdk-cell *cdkCellDef="let rowData" [attr.colspan]="displayedColumns.length">
      <ng-container *ngIf="isRowSelected(rowData)">
        <div *ngFor="let action of rowData.actions" class="actions">
          <button (click)="onActionHandler(rowData, action)" class="action">{{action.title}}</button>
        </div>
      </ng-container>
    </td>
  </ng-container>

  <!-- Header definition -->
  <tr cdk-header-row *cdkHeaderRowDef="displayedColumns"></tr>

  <!-- Iterate through each column -->
  <tr cdk-row *cdkRowDef="let row; columns: displayedColumns"></tr>
  <tr cdk-row *cdkRowDef="let row; columns: ['actions']" when="() => false"></tr>

</table>
